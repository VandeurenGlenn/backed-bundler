{"version":3,"file":"backed-bundler-node.js","sources":["../src/backed-bundler.js"],"sourcesContent":["'use strict;'\nimport { query } from 'dom5';\nimport { parse, serialize } from 'parse5';\n\nconst validateOptions = (entry, html, js, css) => {\n  if (entry === null) {\n    return console.warn('entry::undefined, please defined on in bundler.options.');\n  } else if (!html && !js && !css) {\n    return console.warn('Nothing to bundle, checkout the README to get started');\n  }\n}\n\n/**\n * @return {boolean}\n */\nconst isObject = object => {\n  return typeof object === 'object';\n}\n\n/**\n * @return {boolean}\n */\nconst isNode = object => {\n  return isObject(object) ? object instanceof Node : false;\n}\n\n/**\n * @return {boolean}\n */\nconst isElement = object => {\n  return isObject(object) ? object instanceof HTMLElement : false;\n}\n\n/**\n * @param {string|HTMLElement|node} source Input to check\n * @return {boolean}\n */\nconst needsParse = source => {\n  // when not a node or HTMLElement, code should be parsed so return true\n  if (!isNode(source) || !isElement(source)) return true;\n  return false;\n}\n\nconst replaceChild = (target, node) => {\n  const childNodes = target.childNodes[1].childNodes;\n  let index;\n  for (let child of childNodes) {\n    if (child.nodeName && child.nodeName === node.nodeName) {\n      index = childNodes.indexOf(child);\n    }\n  }\n  childNodes[index] = node;\n  target.childNodes = childNodes;\n}\n\nconst appendChild = (target, node) => {\n  target.childNodes.push(node);\n}\n\nconst removeChild = node => {\n  const childNodes = node.parentNode.childNodes;\n  const index = childNodes.indexOf(node);\n  delete childNodes.splice(index, 1);\n  node.parentNode.childNodes = childNodes;\n}\n\nconst nodeNameRule = (node, nodeName) => {\n  if (node.nodeName && node.nodeName === nodeName) {\n    return node;\n  }\n}\n\n/**\n * Simple querySelector rules for querying 'body'\n * @param {object|node} el The element to run the rules over\n */\nconst queryBody = el => {\n  return nodeNameRule(el, 'body');\n}\n\n/**\n * Simple querySelector rules for querying 'script'\n * @param {object|node} el The element to run the rules over\n */\nconst queryScript = el => {\n  return nodeNameRule(el, 'script');\n}\n\nconst prepareEach = (value = {}, tag = null) => {\n  const node = {\n    nodeName: null,\n    value: null,\n    childNodes: [],\n    attrs: []\n  }\n  if (value && !value.includes(`<${tag}>`)) {\n    node.nodeName = tag;\n    node.tagName = tag;\n    if (tag === 'script') {\n      node.childNodes = [{\n        nodeName: '#text',\n        childNodes: [],\n        attrs: [],\n        value: value\n      }]\n    } else if (tag === 'html') {\n      node.nodeName = 'template';\n      node.tagName = undefined;\n      node.content = value.toString();\n    } else if (tag === 'style') {\n      node.childNodes = [{\n        nodeName: '#text',\n        childNodes: [],\n        attrs: [],\n        value: value\n      }]\n    }\n    node.value = value;\n    return node;\n  }\n}\n\nconst prepare = ({entry, html, js, css}) => {\n  if (needsParse(entry)) entry = parse(entry);\n  const script = query(entry, queryScript);\n  const body = query(entry, queryBody);\n\n  css = prepareEach(css, 'style');\n  js = prepareEach(js, 'script');\n  html = prepareEach(html, 'html');\n\n  return {\n    entry: entry,\n    html: html,\n    js: js,\n    css: css,\n    script: script,\n    body: body\n  }\n}\n\nconst bundle = ({entry, html, js, css, script, body}, removeExternalScript) => {\n  if (css) appendChild(body, css);\n  if (html) appendChild(body, html);\n  if (js) appendChild(body, js);\n  if (script && removeExternalScript && script.attrs[0].name === 'src') {\n    removeChild(script);\n  }\n  replaceChild(entry, body);\n  return serialize(entry);\n}\n/**\r\n * @param {string} entry The file to bundle everything in\r\n * @param {string} html An html or set of html's to include\r\n * @param {string} js An script or set of scripts to include\r\n * @param {string} css An stylesheet or set of stylesheets to include\r\n * @param {string} removeExternalScript Wether or not to include external js\r\n */\r\nexport default ({entry = null, html = null, js = null, css = null, removeExternalScript = true}) => {\r\n    validateOptions(entry, html, js, css);\r\n\r\n    return bundle(prepare({entry: entry, html: html, js: js, css: css}), {removeExternalScript: removeExternalScript});\r\n}\r\n"],"names":["validateOptions","entry","html","js","css","console","warn","isObject","object","isNode","Node","isElement","HTMLElement","needsParse","source","replaceChild","target","node","childNodes","index","child","nodeName","indexOf","appendChild","push","removeChild","parentNode","splice","nodeNameRule","queryBody","el","queryScript","prepareEach","value","tag","includes","tagName","undefined","content","toString","prepare","parse","script","query","body","bundle","removeExternalScript","attrs","name","serialize"],"mappings":"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"}